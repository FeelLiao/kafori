# 一、设计目标
支持按“采集时间 CollectionTime、采集部位 CollectionPart、实验种类 Experiment”进行毫秒级查询；
支持忽略大小写、空格自动匹配实验类别 ExpClassName；
支持用户上传时自动拆分 SampleID → Sample；
支持层级关系：ExpClass → UniqueExID → UniqueID；
支持未来横向扩展（分表、分库、冷热分离）。

# 二、逻辑模型

## 1.实验类别表（exp_class，维度表，极少更新）

```sql
CREATE TABLE exp_class (
    exp_class      SMALLINT PRIMARY KEY comment "实验类别唯一编号",
    exp_class_name VARCHAR(255) NOT NULL UNIQUE comment "实验类别",
    INDEX idx_name (exp_class_name)             -- 用于快速模糊匹配
) ENGINE=InnoDB;
```

## 2. 实验表（experiment，维度表，中等更新频率）

```sql
CREATE TABLE experiment (
    unique_ex_id   BIGINT PRIMARY KEY comment "实验唯一编号",
    exp_class      SMALLINT NOT NULL comment "实验类别",
    experiment     VARCHAR(255) NOT NULL comment "样本所属实验",
    FOREIGN KEY (exp_class) REFERENCES exp_class(exp_class),
    UNIQUE KEY uk_exp (exp_class, experiment)
) ENGINE=InnoDB;
```

## 3. 样本表（sample，事实表，大量写入，按时间分区）

```sql
CREATE TABLE sample (
    unique_id        BIGINT comment "样本唯一编号",
    unique_ex_id     BIGINT NOT NULL comment "实验唯一编号",
    filename         VARCHAR(255),
    sample_id        VARCHAR(255) NOT NULL comment "用户定义id编号",
    sample           VARCHAR(255),
    collection_time  DATE NOT NULL comment "样本采集日期",
    sample_age       TINYINT comment "样本采集时的年龄",
    collection_part  VARCHAR(100) NOT NULL comment "样本采集部位",
    sample_detail    TEXT comment "样本的详细信息",
    deposit_database VARCHAR(100) comment "样本上传的数据库",
    accession        VARCHAR(100) comment "样本在上传数据库中的唯一识别编号",
    origin           VARCHAR(100) comment "样本持有者",
    created_at       DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at       DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    PRIMARY KEY (unique_id, collection_time),
    KEY idx_ex (unique_ex_id),
    KEY idx_time_part (collection_time, collection_part),
    KEY idx_exp_time (unique_ex_id, collection_time)
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(collection_time)) (
    PARTITION p2020 VALUES LESS THAN (2021),
    PARTITION p2021 VALUES LESS THAN (2022),
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION pmax  VALUES LESS THAN MAXVALUE
);
```

## 基因表达量Tpm表 (gene_express_counts,数据量巨大)

```sql
CREATE TABLE `gene_express_tpm` (
  `unique_id` varchar(100) NOT NULL comment "基因tpm唯一id",
  `sample_id` varchar(255) DEFAULT NULL comment "样本唯一编号id",
  `gene_id` varchar(10) DEFAULT NULL comment "基因id,
  `tpm` float DEFAULT NULL comment "tpm值",
  PRIMARY KEY (`unique_id`),
  KEY `idx_sample_id` (`sample_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci


```

## 基因表达量Counts表 (gene_express_counts,数据量巨大)

```sql
CREATE TABLE `gene_express_counts` (
  `unique_id` varchar(100) NOT NULL comment "基因counts唯一id",
  `sample_id` varchar(255) DEFAULT NULL "样本唯一编号id",
  `gene_id` varchar(10) DEFAULT NULL "基因id,
  `counts` int DEFAULT NULL "counts值",
  PRIMARY KEY (`unique_id`),
  KEY `idx_sample_id` (`sample_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci


```

# 三、索引策略

| 查询场景                 | 使用索引                                              |
| -------------------- | ------------------------------------------------- |
| 按实验种类 Experiment     | unique\_ex\_id → idx\_ex                          |
| 按采集时间 CollectionTime | collection\_time → idx\_time\_part、idx\_exp\_time |
| 按采集部位 CollectionPart | collection\_part → idx\_time\_part                |
| 复合条件（实验 + 时间 + 部位）   | 使用覆盖索引 idx\_exp\_time 或 idx\_time\_part           |

# 四、扩展建议

##1.冷数据归档：把 3 年以上分区改为压缩表（ROW_FORMAT=COMPRESSED）。

2.如果实验类别数 > 1000，可考虑将 sample 表拆分为 sample_${exp_class}，利用中间件（ShardingSphere）路由。





